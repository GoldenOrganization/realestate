<!DOCTYPE html>
<html class='no-js' lang='en'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>HouseAdmin</title>
    <link href="assets/stylesheets/application-a07755f5.css" rel="stylesheet" type="text/css" />
    <link href="assets/images/favicon.ico" rel="icon" type="image/ico" />
    <link href="./css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="./css/zeroModal.css" type="text/css" media="all">
		<link rel="stylesheet" href="./css/iconfont.css" type="text/css" media="all">

  </head>
  <body class='main page'>
    <!-- Navbar -->
    <div class='navbar navbar-default' id='navbar'>
      <a class='navbar-brand' href='#'>
        <i class='icon-beer'></i>
        HouseAdmin
      </a>
      <ul class='nav navbar-nav pull-right'>

        <li class='dropdown user'>
          <a class='dropdown-toggle' data-toggle='dropdown' href='#'>
            <i class='icon-user'></i>
            <strong>Admin</strong>
            <b class='caret'></b>
          </a>

        </li>
      </ul>
    </div>
    <div id='wrapper'>
      <!-- Sidebar -->
      <section id='sidebar'>

        <ul id='dock'>
          <li class='launcher'>
		   <br>
		   <i class="icon iconfont"  style="font-size:40px;">&#xe640;</i>
            <a href="dashboard_admin.html">Dashboard</a>
          </li>
          <li class='active launcher'>
		   <br>
		   <i class="icon iconfont" style="font-size:40px;">&#xf0019;</i>
            <a href="house_admin.html">Houses</a>
          </li>
          <li class=' launcher'>
		  <br>
		  <i class="icon iconfont" style="font-size:40px;">&#xe611;</i>
            <a href="news_admin.html">News</a>
          </li>
          
        </ul>
        <div data-toggle='tooltip' id='beaker' title=''></div>
      </section>
      <!-- Tools -->
      <section id='tools'>
        <ul class='breadcrumb' id='breadcrumb'>
          <li class='title'>添加房产信息</li>
        </ul>
        <div id='toolbar'>
          
        </div>
      </section>
      <!-- Content -->
      <div id='content'>
        <div class='panel panel-default'>
          <div class='panel-heading'>
            <i class='icon-edit icon-large'></i>
            添加房产
          </div>
          <div class='panel-body'>
           <form name="example_form" action="" method="post">
              <fieldset>
                <legend>房产信息</legend>
                <div class='form-group'>
                  <label class='control-label'>房产名称[中文]</label>
                  <input id="name_cn" name="name_cn" class='form-control' placeholder='Enter name' type='text' >
                </div>
                <div class='form-group'>
                  <label class='control-label'>realestate name[EN]</label>
                  <input id="name_en" name="name_en" class='form-control' placeholder='Enter name' type='text'>
                </div>
				<div class='form-group'>
                  <label class='control-label'>选择房产类型[至少必选一项]</label>
                  <br>
                  <div class='checkbox-inline'>
                    <input type='checkbox' value='公寓'>
                    公寓[apartment]
                  </div>
                  <div class='checkbox-inline'>
                    <input type='checkbox' value='现房'>
                    现房[completed]
                  </div>
                  <div class='checkbox-inline'>
                    <input type='checkbox' value='别墅'>
                    别墅[villa]
                  </div>
				  <div class='checkbox-inline'>
                    <input type='checkbox' value='楼花'>
                    楼花[uncompleted]
                  </div>
				  <div class='checkbox-inline'>
                    <input type='checkbox' value='联排别墅'>
                    联排别墅[united villa]
                  </div>
				  <div class='checkbox-inline'>
                    <input type='checkbox' value='已售'>
                    已售[sold]
                  </div>
                </div>
                <br>
				<div class="form-group">
        <label class='control-label'>是否将此房产放入首页幻灯片</label>
  <label>
    <input type="radio" name="optionsRadios" id="optionsRadios1" value="1">是
  </label>
  <label>
    <input type="radio" name="optionsRadios" id="optionsRadios2" value="0" checked>否
  </label>
</div>
				<div id="display" class='form-group'>
                  <label class='control-label'>幻灯片显示简介[中文]</label>
                  <input id="sintro_cn" name="sintro_cn" class='form-control' placeholder='幻灯片显示简介' type='text'>
				  <span class="help-block">*此简介连同房产名都将显示在首页的移动幻灯片图片之上</span>
                </div>
                <div id="display_en" class='form-group'>
                  <label class='control-label'>slide display[EN]</label>
                  <input id="sintro_en" name="sintro_en" class='form-control' placeholder='slide display[EN]' type='text'>
                </div>
				<div class='form-group'>
                  <label class='control-label'>简介[中文][可输入html标签]</label>
                  <textarea id="intro_cn" name="intro_cn"  class='form-control' rows='4'></textarea>
                  
                  <span>工具:点击<a target="_blank" href="http://ckeditor.com/features">此处</a>进入html编辑器</span>
                </div>
				<div class='form-group'>
                  <label class='control-label'>Intro[EN]</label>
                  <textarea id="intro_en" name="intro_en"  class='form-control' rows='4'></textarea>
                </div>
				<div class='form-group'>
                  <label class='control-label'>详细介绍[中文][可输入html标签]</label>
                  <textarea  id="detail_cn" name="detail_cn" class='form-control' rows='6'></textarea>
                  <span>工具:点击<a target="_blank" href="http://ckeditor.com/features">此处</a>进入html编辑器</span>
                </div>
				<div class='form-group'>
                  <label class='control-label'>Intro Detail[EN]</label>
                  <textarea  id="detail_en" name="detail_en"  class='form-control' rows='6'></textarea>
                </div>
				<div class='form-group'>
                  <label class='control-label'>房产配套[中文][可输入html标签]</label>
                  <textarea   id="fac_cn" name="fac_cn" class='form-control' rows='4'></textarea>
                  <span>工具:点击<a target="_blank" href="http://ckeditor.com/features">此处</a>进入html编辑器</span>
                </div>
				<div class='form-group'>
                  <label class='control-label'>facilities[EN]</label>
                  <textarea  id="fac_en"  name="fac_en"   class='form-control' rows='4'></textarea>
                </div>
				<div class='form-group'>
                  <label class='control-label'>价格[AUD]</label>
                  <input   id="price" name="price" class='form-control' placeholder='500000' type='text'>
                </div>
				<div class='form-group'>
                  <label class='control-label'>价格介绍[中文][可输入html标签]</label>
                  <textarea  id="price_cn"  class='form-control' rows='4'></textarea>
                  <span>工具:点击<a target="_blank" href="http://ckeditor.com/features">此处</a>进入html编辑器</span>
                </div>
				<div class='form-group'>
                  <label class='control-label'>Price Intro[EN]</label>
                  <textarea id="price_en"  class='form-control' rows='4'></textarea>
                </div>
                <ul class='breadcrumb'>
          <li class='title'><b>主图片上传区域</b></li>
        
                <div id="im_1" class="form-group">
                  <label class='control-label'>已选主图片</label>
                  <div id="ta_1">
                  
                  </div>
                </div>
				<div class="form-group">
					<label class='control-label'>主图片上传[只允许一张] *需在点击'提交全部'之前先'上传'图片*</label>
                    <input id="file-3" name = "file-3" type="file" multiple data-max-file-count="1">
					<label class='control-label'>主图片最终上传的图片及路径 </label><a id='del1'> 清空</a>
          <br>
          <input type="textarea" id="tlabel1"  class='form-control' rows='2' readOnly="true" />
                </div>
</ul>
<p>
<ul class='breadcrumb'>
          <li class='title'><b>房源图片上传区域</b></li>

        <div id="im_2" class="form-group">
                  <label class='control-label'>已选房源图片</label>
                  <div id="ta_2"></div>
                </div>

				<div class="form-group">
					<label class='control-label'>房源图片[至少2张] *需在点击'提交全部'之前先'上传'图片*</label>
                    <input id="file-1" name = "file-1"  type="file" multiple class="file" data-overwrite-initial="false" data-min-file-count="2">
					<label class='control-label'>房源图片最终上传的图片及路径 </label><a id='del2'> 清空</a>
          <br>
          <input type="textarea" id="tlabel2"  class='form-control'  rows='2' readOnly="true" />
                </div>
</ul>
<p>
<ul class='breadcrumb'>
          <li class='title'><b>户型图片上传区域</b></li>
        <div id="im_3" class="form-group">
                  <label class='control-label'>已选户型图片</label>
                  <div id="ta_3"></div>
                </div>

				
				<div class="form-group">
					<label class='control-label'>户型图片[至少1张] *需在点击'提交全部'之前先'上传'图片*</label>
                    <input id="file-2" name = "file-2"  type="file" multiple class="file" data-overwrite-initial="false" data-min-file-count="1">
					<label class='control-label'>房源图片最终上传的图片及路径 </label><a id='del3'> 清空</a>
          <br>
          <input type="textarea" id="tlabel3"  class='form-control' rows='2' readOnly="true" />
                </div>
                </ul>
        <div class="error_box" style="display: none; color:#FF5500;"></div>
		<div class="success_box" style="display: none;">All Fields were successfully validated! Data has been sent</div>
              <div class='form-actions'>
                <button id="submited" class='btn btn-primary btn-lg' style="background-color:#448ECB" type='submit'>提交全部</button>

                <a class='btn' href='#'>Cancel</a>
              </div>
            </form>
          </div>
        </div>


      </div>
    </div>
    <!-- Footer -->
    <!-- Javascripts -->

    <script src="./js/jquery.min.js" type="text/javascript"></script>
	<script src="./js/fileinput.min.js" type="text/javascript"></script>
    <script src="./js/fileinput_locale_zh.js" type="text/javascript"></script>
	<script src="//cdn.bootcss.com/jquery-ui-bootstrap/0.5pre/assets/js/jquery-ui-1.10.0.custom.min.js" type="text/javascript"></script>
	<script src="./js/modernizr.min.js" type="text/javascript"></script>
	<script src="assets/javascripts/application-985b892b.js" type="text/javascript"></script>
	<script type="text/javascript" src="./js/zeroModal.min.js" defer="" onload=""></script>
	<script type="text/javascript" src="./js/validate.min.js"></script>
    <!-- Google Analytics -->
	
	<script>
	
	          (function ($) {
                $.getUrlParam = function (name) {
                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                    var r = window.location.search.substr(1).match(reg);
                    if (r != null) return unescape(r[2]); return null;
                }
            })(jQuery);
  var id = $.getUrlParam("id");
  if(id==null){

$("#im_1").hide();
$("#im_2").hide();
$("#im_3").hide();

$("#submited").text("新增房产");

$("#file-3").fileinput({
    browseClass: "btn btn-primary btn-block",
    showCaption: false,
    showRemove: false,
    showUpload: true,
    uploadUrl: 'fileUpload', 
//    browseClass: "btn btn-primary btn-lg",
    allowedFileExtensions : ['jpg', 'png','gif','jpeg'],
//        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
  });
      $("#file-1").fileinput({
        showUpload: true,
        uploadUrl: 'fileUpload', 
        allowedFileExtensions : ['jpg', 'png','gif','jpeg'],
        overwriteInitial: false,
        maxFileSize: 10000,
        maxFilesNum: 10,
        slugCallback: function(filename) {
            return filename.replace('(', '_').replace(']', '_');
        }
  });
    $("#file-2").fileinput({
        showUpload: true,
        uploadUrl: 'fileUpload', 
        allowedFileExtensions : ['jpg', 'png','gif','jpeg'],
        overwriteInitial: false,
        maxFileSize: 10000,
        maxFilesNum: 10,
        slugCallback: function(filename) {
            return filename.replace('(', '_').replace(']', '_');
        }
  });
  }else{

    
$("#submited").text("提交更新");

    $.ajax({
        url: 'realestate?method=houses_cn',
        dataType: 'json',
        success: function(data) {

      localStorage.setItem("json_data_houses_cn",JSON.stringify(data)); 
 
        },
        statusCode: {
          404: function() {
      //error handling
          }
        }
      });
     var json_data = JSON.parse(localStorage.getItem("json_data_houses_cn"));
    $.each(json_data, function (n, value) {
      if(value.id==id){
        $("#name_cn").val(value.name);
      $("#name_en").val(value.name_en);
      $("#sintro_cn").val(value.sintro);      
      $("#sintro_en").val(value.sintro_en);      
      $("#intro_cn").val(value.intro);      
      $("#intro_en").val(value.intro_en);      
      $("#detail_cn").val(value.detail);      
      $("#detail_en").val(value.detail_en);      
      $("#fac_cn").val(value.fac);      
      $("#fac_en").val(value.fac_en);      
      $("#price").val(value.price);      
      $("#price_cn").val(value.price_des);
      $("#price_en").val(value.price_des_en);

      if(value.display==1){
        $("#optionsRadios1").attr("checked",true); 
        $("#optionsRadios2").attr("checked",false); 
      }

      var arrke = value.keyword.split(",");
      arrke.forEach(function(text){
          $("input[value="+text+"]").attr("checked",true);
      })

      // alert(value.img);
      // alert(value.img_d);
      // alert(value.housemap);

      //主图片设置区
      $("#ta_1").append("<br><img src=\'"+value.img+"\' style=\'height: 250px\'><br><input value=\'tet\' type=\'checkbox\' id=\'cb1_1\'  /><label >"+value.img+"</label>")

      $("#tlabel1").val(value.img+",");

      $("#cb1_1").attr("checked",true);
      $("#cb1_1").click(function(){
        if($("#cb1_1").is(':checked')){
          $("#tlabel1").val(value.img+",");
        }else{
          $("#tlabel1").val("");
        }
      });

      //房源图片设置区
      var img_d_arr=value.img_d.split(",");

      img_d_arr.forEach(function(data,n){

        $("#ta_2").append("<br><img src=\'"+data+"\' style=\'height: 250px\'><br><input type=\'checkbox\' value=\'tet\'  data-v=\'"+data+"\' id=\'cb2_"+n+"\' checked /><label >"+data+"</label>");
      })

      $("#tlabel2").val(value.img_d+",");

      img_d_arr.forEach(function(data,n){

        $("#cb2_"+n).click(function(){
          if($("#cb2_"+n).is(':checked')){
            $("#tlabel2").val($("#tlabel2").val()+$("#cb2_"+n).attr("data-v")+",");
          }else{
            $("#tlabel2").val($("#tlabel2").val().replace($("#cb2_"+n).attr("data-v")+",",""));

          }
        });
      });

    //户型图片设置区
      var housemap_arr=value.housemap.split(",");

housemap_arr.forEach(function(data,n){

        $("#ta_3").append("<br><img src=\'"+data+"\' style=\'height: 250px\'><br><input type=\'checkbox\' value=\'tet\'  data-v=\'"+data+"\' id=\'cb3_"+n+"\' checked /><label >"+data+"</label>");
      })

      $("#tlabel3").val(value.housemap+",");

      housemap_arr.forEach(function(data,n){

        $("#cb3_"+n).click(function(){
          if($("#cb3_"+n).is(':checked')){
            $("#tlabel3").val($("#tlabel3").val()+$("#cb3_"+n).attr("data-v")+",");
          }else{
            $("#tlabel3").val($("#tlabel3").val().replace($("#cb3_"+n).attr("data-v")+",",""));
          }
        });
      });




      $("#file-3").fileinput({
    browseClass: "btn btn-primary btn-block",
    showCaption: false,
    showRemove: false,
    showUpload: true,
    uploadUrl: 'fileUpload', 
//    browseClass: "btn btn-primary btn-lg",
    allowedFileExtensions : ['jpg', 'png','gif','jpeg'],
//        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
  });
      $("#file-1").fileinput({
        showUpload: true,
        uploadUrl: 'fileUpload', 
        allowedFileExtensions : ['jpg', 'png','gif','jpeg'],
        overwriteInitial: false,
        maxFileSize: 10000,
        maxFilesNum: 10,
        slugCallback: function(filename) {
            return filename.replace('(', '_').replace(']', '_');
        }
  });
    $("#file-2").fileinput({
        showUpload: true,
        uploadUrl: 'fileUpload', 
        allowedFileExtensions : ['jpg', 'png','gif','jpeg'],
        overwriteInitial: false,
        maxFileSize: 10000,
        maxFilesNum: 10,
        slugCallback: function(filename) {
            return filename.replace('(', '_').replace(']', '_');
        }
  });



      }
    });

  }
	
		

//     $('#file-3').on('fileloaded', function(event, file, previewId, index, reader) {
//     console.log("fileloaded");
//     alert(file.name);
//     $("#file-3-label").append("./uploadFile/"+file.name);
// });
      $("#del1").click(function(){
        $("#tlabel1").val("");
      });
       $("#del2").click(function(){
        $("#tlabel2").val("");
      });
        $("#del3").click(function(){
        $("#tlabel3").val("");
      });
	
	$('#file-3').on('fileuploaded', function(event, data, previewId, index) {  
    $("#tlabel1").val("./uploadFile/"+data.files[0].name+",");
});
	$('#file-1').on('filebatchpreupload', function(event, data, previewId, index) {
	for(var key in data.files){
    $("#tlabel2").val($("#tlabel2").val()+"./uploadFile/"+data.files[key].name+",");
	}
});
	$('#file-2').on('filebatchpreupload', function(event, data, previewId, index) {
	for(var key in data.files){
    $("#tlabel3").val($("#tlabel3").val()+"./uploadFile/"+data.files[key].name+",");
	}
});

//   $('#file-3').on('fileloaded', function(event, file, previewId, index, reader) {
//     alert(file.name);
// });

//   $('#file-3').on('filedeleted', function(event, key) {
//     alert(key);
// });

//   $('#file-3').on('filecleared', function(event) {
//     alert("clear");
// });

//   $('#file-3').on('filepredelete', function(event,key) {
//     alert("efef");
// });

		    function _loading(type) {
			zeroModal.loading(type);
		}
		    function _success() {
			zeroModal.success('添加/更新成功!');
		}




	new FormValidator('example_form', [{
    name: 'name_cn',
    display: '房产名称[中文]',
    rules: 'required'
}, {
// 	name: 'name_en',
//     display: 'realestate name[EN]',
//     rules: 'required'
// }, {
	name: 'sintro_cn',
    display: '幻灯片显示简介[中文]',
    rules: 'required'
}, {
// 	name: 'sintro_en',
//     display: 'slide display[EN]',
//     rules: 'required'
// }, {
	name: 'intro_cn',
    display: '简介[中文]',
    rules: 'required'
}, {
// 	name: 'intro_en',
//     display: 'Intro[EN]',
//     rules: 'required'
// }, {
	name: 'detail_cn',
    display: '详细介绍[中文]',
    rules: 'required'
}, {
// 	name: 'detail_en',
//     display: 'Intro Detail[EN]',
//     rules: 'required'
// }, {
// 	name: 'fac_cn',
//     display: '房产配套[中文]',
//     rules: 'required'
// }, {
// 	name: 'fac_en',
//     display: 'facilities[EN]',
//     rules: 'required'
// }, {
    name: 'price',
	display: '价格[AUD]',
    rules: 'required|numeric'

}], function(errors, evt) {

    var SELECTOR_ERRORS = $('.error_box'),
        SELECTOR_SUCCESS = $('.success_box');

    if (errors.length > 0) {
        SELECTOR_ERRORS.empty();

        for (var i = 0, errorLength = errors.length; i < errorLength; i++) {
            SELECTOR_ERRORS.append(errors[i].message + '<br />');
        }

        SELECTOR_SUCCESS.css({ display: 'none' });
        SELECTOR_ERRORS.fadeIn(200);
    } else {
        SELECTOR_ERRORS.css({ display: 'none' });
        
		var type ="";
		$(":checkbox:checked").each(function(i, eleDom){
        if(eleDom.value!="tet"){
          type+=eleDom.value+",";
        }
		});
		type=type.substring(0,type.length-1);

    var displayed = $("input[name='optionsRadios']:checked").val();

    if($("#submited").text()=="提交更新"){
$.post("posthouse",{
        id:id,
        name_cn: $("#name_cn").val(), 
        name_en: $("#name_en").val(), 
        type_cn: type,
        sintro_cn: $("#sintro_cn").val(),
        sintro_en: $("#sintro_en").val(),
        intro_cn: $("#intro_cn").val(),
        intro_en: $("#intro_en").val(),
        detail_cn: $("#detail_cn").val(),
        detail_en: $("#detail_en").val(),
        fac_cn: $("#fac_cn").val(),
        fac_en: $("#fac_en").val(),
        price: $("#price").val(),
        price_cn: $("#price_cn").val(),
        price_en: $("#price_en").val(),
        img:$("#tlabel1").val().substring(0,$("#tlabel1").val().length-1),
        img_d:$("#tlabel2").val().substring(0,$("#tlabel2").val().length-1),
        house_img:$("#tlabel3").val().substring(0,$("#tlabel3").val().length-1),
        display:displayed,
        }, function(data) {
          _loading(5);
        })
        .success(function() {  })
        .error(function() {  })
        .complete(function() { 

        zeroModal.closeAll();
        SELECTOR_SUCCESS.fadeIn(200);
        _success();});



    }else if($("#submited").text()=="新增房产")
{

			$.post("posthouse",{
        id:"none",
				name_cn: $("#name_cn").val(), 
				name_en: $("#name_en").val(), 
				type_cn: type,
				sintro_cn: $("#sintro_cn").val(),
				sintro_en: $("#sintro_en").val(),
				intro_cn: $("#intro_cn").val(),
				intro_en: $("#intro_en").val(),
				detail_cn: $("#detail_cn").val(),
				detail_en: $("#detail_en").val(),
				fac_cn: $("#fac_cn").val(),
				fac_en: $("#fac_en").val(),
				price: $("#price").val(),
				price_cn: $("#price_cn").val(),
				price_en: $("#price_en").val(),
				img:$("#tlabel1").val().substring(0,$("#tlabel1").val().length-1),
        img_d:$("#tlabel2").val().substring(0,$("#tlabel2").val().length-1),
        house_img:$("#tlabel3").val().substring(0,$("#tlabel3").val().length-1),
        display:displayed,
				}, function(data) {
					_loading(5);
				})
				.success(function() {  })
				.error(function() {  })
				.complete(function() { 

				zeroModal.closeAll();
				SELECTOR_SUCCESS.fadeIn(200);
				_success();});
    }

  }

    if (evt && evt.preventDefault) {
        evt.preventDefault();
    } else if (event) {
        event.returnValue = false;
    }
});
	
	</script>
  </body>
</html>
